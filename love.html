<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Love</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body{margin:0;height:100vh;background:radial-gradient(ellipse at center,#07020a 0%, #000 60%);color:#fff;font-family:Inter,Arial}
    .scene{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;perspective:1000px;overflow:hidden}
    .heart-wrap{width:500px;height:500px;position:relative;transform-style:preserve-3d;transform:rotateX(15deg) rotateY(0deg);animation:slowspin 12s linear infinite}
    @keyframes slowspin{0%{transform:rotateX(10deg) rotateY(0deg)}50%{transform:rotateX(10deg) rotateY(180deg)}100%{transform:rotateX(10deg) rotateY(360deg)}}
    .node{position:absolute;left:50%;top:50%;transform-origin:center;font-weight:700;font-size:18px;letter-spacing:2px;white-space:nowrap;filter:drop-shadow(0 0 8px rgba(234,128,176,0.6));color:#ffb0d9;text-shadow:0 0 6px rgba(255,255,255,0.9);opacity:0.95}
    .subtitle{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);color:#ddd;font-size:14px;opacity:0.9;background:transparent;padding:6px 10px;border-radius:8px}
  </style>
</head>
<body>
  <div class="scene">
    <div id="heart" class="heart-wrap" aria-hidden="true"></div>
  </div>
  <div class="subtitle">ส่งให้คนพิเศษของคุณ ❤️</div>

  <script>
    // อ่านข้อความจาก query param ?msg=
    function getParam(name) {
      try {
        var params = new URLSearchParams(window.location.search);
        return params.get(name) || "I love you ❤️";
      } catch (e) {
        return "I love you ❤️";
      }
    }
    var message = getParam('msg');

    var container = document.getElementById('heart');

    // สร้างจุดบนสมการหัวใจ
    var points = [];
    var N = 120;
    for (var i = 0; i < N; i++) {
      var t = (i / N) * Math.PI * 2;
      var x = 16 * Math.pow(Math.sin(t), 3);
      var y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      points.push({x: x, y: y});
    }

    var scale = 14;
    var offsetY = -30;

    for (var i = 0; i < points.length; i++) {
      var p = points[i];
      var el = document.createElement('span');
      el.className = 'node';
      // แสดงข้อความ (ถ้ามายาว อาจจะตัดสั้น)
      var text = message;
      if (text.length > 28) text = text.substring(0, 28) + '...';
      el.textContent = text;

      var px = p.x * scale;
      var py = p.y * scale + offsetY;
      el.style.left = 'calc(50% + ' + px + 'px)';
      el.style.top = 'calc(50% - ' + py + 'px)';

      // คำนวณมุมประมาณโดยอนุมานความต่างของจุดข้างเคียง
      var prev = points[(i - 1 + points.length) % points.length];
      var next = points[(i + 1) % points.length];
      var dx = next.x - prev.x;
      var dy = next.y - prev.y;
      var ang = Math.atan2(dy, dx) * 180 / Math.PI;
      el.style.transform = 'translate(-50%,-50%) rotate(' + ang + 'deg) translateZ(' + ((i % 8) - 4) + 'px) scale(' + (1 - (i % 6) * 0.02) + ')';

      el.style.zIndex = String(1000 - Math.abs(i - points.length/2));
      el.style.animation = 'puls 2.6s ease-in-out ' + ((i % 10) / 20) + 's infinite';
      container.appendChild(el);
    }

    // เพิ่ม keyframes ไดนามิก
    var st = document.createElement('style');
    st.innerHTML = '@keyframes puls{0%{transform:translate(-50%,-50%) rotate(0deg) translateZ(0px) scale(0.98);opacity:0.9}50%{transform:translate(-50%,-50%) rotate(0deg) translateZ(8px) scale(1.04);opacity:1}100%{transform:translate(-50%,-50%) rotate(0deg) translateZ(0px) scale(0.98);opacity:0.9}}';
    document.head.appendChild(st);

    // mouse tilt
    document.addEventListener('mousemove', function(e) {
      var cx = window.innerWidth / 2;
      var cy = window.innerHeight / 2;
      var dx = (e.clientX - cx) / cx;
      var dy = (e.clientY - cy) / cy;
      container.style.transform = 'rotateX(' + (10 + dy*15) + 'deg) rotateY(' + (dx*20) + 'deg)';
    });
  </script>
</body>
</html>

