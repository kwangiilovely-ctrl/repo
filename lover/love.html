<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Love</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* แทนคำสไตล์เพิ่มเติมเฉพาะหน้านี้ */
    body{background:radial-gradient(ellipse at center,#07020a 0%, #000 60%);}
    .scene{
      width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;
      perspective:1000px; overflow:hidden;
    }
    .heart-wrap{
      width:500px;height:500px;position:relative;transform-style:preserve-3d;
      transform: rotateX(15deg) rotateY(0deg);
      animation: slowspin 12s linear infinite;
    }
    @keyframes slowspin{
      0%{ transform: rotateX(10deg) rotateY(0deg) }
      50%{ transform: rotateX(10deg) rotateY(180deg) }
      100%{ transform: rotateX(10deg) rotateY(360deg) }
    }
    .node{
      position:absolute; left:50%; top:50%;
      transform-origin:center;
      font-weight:700;
      font-size:18px;
      letter-spacing:2px;
      white-space:nowrap;
      filter: drop-shadow(0 0 8px rgba(234,128,176,0.6));
      color: #ffb0d9;
      text-shadow: 0 0 6px rgba(255,255,255,0.9);
      opacity:0.95;
    }
    .subtitle{
      position:fixed;bottom:20px;left:50%;transform:translateX(-50%);color:#ddd;font-size:14px;opacity:0.9;
      backdrop-filter: blur(6px); padding:6px 10px;border-radius:8px;
    }
  </style>
</head>
<body>
  <div class="scene">
    <div id="heart" class="heart-wrap"></div>
  </div>
  <div class="subtitle">ส่งให้คนพิเศษของคุณ ❤️</div>

  <script>
    // อ่านข้อความจาก URL ?msg=
    function getParam(name){
      const u = new URL(location.href);
      return u.searchParams.get(name) || "I love you ❤️";
    }
    const message = decodeURIComponent(getParam('msg'));

    const container = document.getElementById('heart');

    // สมการหัวใจ (parametric) — ใช้ t จาก 0..2PI
    // x = 16*sin^3(t)
    // y = 13*cos(t) - 5*cos(2t) - 2*cos(3t) - cos(4t)
    // (ค่าตัวเลขเอามาจากสมการหัวใจคลาสสิค)
    const points = [];
    const N = 120; // จำนวนข้อความจุดบนเส้นหัวใจ (ปรับได้)
    for(let i=0;i<N;i++){
      const t = (i / N) * Math.PI * 2;
      const x = 16 * Math.pow(Math.sin(t),3);
      const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      points.push({x,y,t});
    }

    // แปลงให้พิกเซล และสร้าง node
    // ปรับ scale/offset ให้พอดีกับ container
    const scale = 14; // ขยายขนาดหัวใจ
    const offsetX = 0;
    const offsetY = -30;
    for(let i=0;i<points.length;i++){
      const p = points[i];
      const el = document.createElement('span');
      el.className = 'node';
      el.innerText = message; // หรือใช้ message.split(' ')[0] ถ้าต้องการสั้น
      // คำนวณตำแหน่ง
      const px = p.x * scale + offsetX;
      const py = p.y * scale + offsetY;
      // วางตำแหน่ง (50% คือจุดกึ่งกลาง)
      el.style.left = calc(50% + ${px}px);
      el.style.top = calc(50% - ${py}px);
      // หมุนให้เข้าทิศทางเส้น (approx) เพื่อให้ข้อความตามแนวเส้น
      const angleDeg = (Math.atan2(
        // derivative approximate
        ( (points[(i+1)%points.length].y - points[(i-1+points.length)%points.length].y) ),
        ( (points[(i+1)%points.length].x - points[(i-1+points.length)%points.length].x) )
      ) * 180 / Math.PI);
      el.style.transform = translate(-50%,-50%) rotate(${angleDeg}deg) translateZ(${(i%8)-4}px) scale(${1 - (i%6)*0.02});
      // depth effect: z-index and scale to fake 3D
      el.style.zIndex = ${1000 - Math.abs(i - points.length/2)};
      // subtle animation timing stagger
      el.style.animation = puls 2.6s ease-in-out ${ (i%10)/20 }s infinite;
      container.appendChild(el);
    }

    // เล็กๆ keyframe สำหรับพัลส์
    const style = document.createElement('style');
    style.innerHTML = `
      @keyframes puls{
        0%{ transform: translate(-50%,-50%) rotate(0deg) translateZ(0px) scale(0.98); opacity:0.9 }
        50%{ transform: translate(-50%,-50%) rotate(0deg) translateZ(8px) scale(1.04); opacity:1 }
        100%{ transform: translate(-50%,-50%) rotate(0deg) translateZ(0px) scale(0.98); opacity:0.9 }
      }`;
    document.head.appendChild(style);

    // optional: mouse interaction to tilt
    let lastX=0;
    document.addEventListener('mousemove', (e)=>{
      const cx = window.innerWidth/2;
      const cy = window.innerHeight/2;
      const dx = (e.clientX - cx)/cx;
      const dy = (e.clientY - cy)/cy;
      container.style.transform = rotateX(${10 + dy*15}deg) rotateY(${dx*20}deg);
    });

  </script>
</body>
</html>